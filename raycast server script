local tool = script.Parent
local laserFireEvent = tool.RemoteEvents:FindFirstChild("LaserFire")
local laserFolder = game.Workspace.Folder

if game.ReplicatedStorage.Ammo.Value == 0 then
	laserFolder.Name = "Reloading..."
end
local debris = game:GetService("Debris")
local midpointvalue = script.Parent.Configuration.MidPointValue

local function CreateBeam(origin, direction)
	
	local part = Instance.new("Part", game.Workspace)
	script.Parent = part
	part.Parent = laserFolder

	local midpoint = origin + direction/midpointvalue.Value
	
	part.CFrame = CFrame.new(midpoint, origin)
	part.Size = Vector3.new(.1, .1, direction.magnitude)
	script.Parent.Client.Sounds.Fire:Play()
	part.Anchored = true
	part.CanCollide = false
end

laserFireEvent.OnServerEvent:Connect(function(player, mousePos, originPos)
	local RayDistance = script.Parent.SizeOfRay
	
	local direction = (mousePos - originPos).Unit * RayDistance.Value

	local result = workspace:Raycast(originPos, direction)

	if result then 
		local character = result.Instance.Parent 
		local humanoid = character:FindFirstChild("HumanoidRootPart")
		CreateBeam(originPos, direction)

		local Settings = {
			
			Gore = true
		}
		
		if humanoid and humanoid ~= player.Character.Humanoid then 
			local DamageValue = script.Parent.Configuration.Damage
			if Settings.Gore == true then
				if humanoid.Parent:FindFirstChild("HumanoidRootPart")  then
					local Gore = game.ReplicatedStorage.Particles.GorePart.ParticleEmitter:Clone()
					Gore.Parent = humanoid.Parent:FindFirstChild("HumanoidRootPart")
					task.wait(1)
					Gore:Destroy()
				end
			end
		end

	end
end)


