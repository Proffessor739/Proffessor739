local tool = script.Parent
local origin = tool:WaitForChild("Handle").Origin 

local player = game.Players.LocalPlayer
local mouse = player:GetMouse()
local AmmoValue = game.ReplicatedStorage.Ammo

local Laserevent = script.Parent.RemoteEvents.LaserFire
local laserFolder = game.Workspace.Folder

tool.Activated:Connect(function()
	local mousePostion = mouse.Hit.p
	local originPosition = origin.Position

	Laserevent:FireServer(mousePostion, originPosition)
end)

script.Parent.Equipped:Connect(function()
	mouse.Button1Down:Connect(function()
		AmmoValue.Value = AmmoValue.Value -1
		if AmmoValue.Value == 0 then
			script.Disabled = true
		end
	end)
end)

local function Aim()
	local camera = game.Workspace:FindFirstChild("Camera")
	camera.FieldOfView = 30

	local starterplayer = game:GetService("StarterPlayer")

	starterplayer.CameraMaxZoomDistance = 10
	starterplayer.CameraMinZoomDistance = 10

	local player = game.Players.LocalPlayer
	local char = player.CharacterAdded:Wait()
	local humanoid = char.Humanoid

	humanoid.WalkSpeed = 5

	print(player.Name .. " is aiming")

end

local function StopAim()
	local camera = game.Workspace.Camera
	camera.FieldOfView = 70
	print(player.Name .. " stopped aiming")
end

tool.Equipped:Connect(function()
	mouse.Button2Down:Connect(Aim)
	mouse.Button2Up:Connect(StopAim)
	script.Parent.Client.Sounds.Equip:Play()
end)


local function Unequip()
	local camera = game.Workspace.Camera
	camera.FieldOfView = 70
end

tool.Unequipped:Connect(Unequip)

script.Parent.Equipped:Connect(function()
	local player = game:GetService("Players").LocalPlayer
	local character = player.Character or player.CharacterAdded:Wait()
	
	game:GetService("RunService").RenderStepped:Connect(function()
		for i, part in pairs(character:GetChildren()) do
			if string.match(part.Name, "Arm") or string.match(part.Name, "Hand") then
				part.LocalTransparencyModifier = 0
			end
		end
	end)
end)
